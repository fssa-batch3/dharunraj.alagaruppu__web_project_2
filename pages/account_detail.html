<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Account Details</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <link rel="stylesheet" href="../assets/css/account.css">
</head>

<body>

    <div class="main">
    </div>

</body>

<script>

    //Right side container

    let content_list = document.createElement("div");
    content_list.setAttribute("class", "content_list");
    document.querySelector(".main").append(content_list);



    let simple_detail = document.createElement("div");
    simple_detail.setAttribute("class", "simple_detail");
    document.querySelector(".main").append(simple_detail);


    let profile_name = document.createElement("h2");
    profile_name.setAttribute("id", "fi_name");
    simple_detail.append(profile_name);

    let simple_image = document.createElement("img");
    simple_image.setAttribute("id", "simple_image");
    simple_image.setAttribute("src", "");
    simple_image.setAttribute("alt", "i");
    simple_detail.append(simple_image);



    let file_uplad = document.createElement("div");
    file_uplad.setAttribute("class", "file_uplad");
    simple_detail.append(file_uplad);

    let simple_upload = document.createElement("input");
    simple_upload.setAttribute("type", "file");
    simple_upload.setAttribute("id", "simple_upload");
    simple_upload.setAttribute("name", "simple_upload");
    file_uplad.append(simple_upload);

    let simple_label = document.createElement("label");
    simple_label.setAttribute("for", "simple_upload");
    simple_label.setAttribute("id", "label_file");
    simple_label.innerText = ("Change profile");
    file_uplad.append(simple_label);



    let simple_text = document.createElement("p");
    simple_text.setAttribute("class", "simple_text");
    simple_text.innerText = "Upload a new avatar.Larger image will be resized automatically .";
    simple_detail.append(simple_text);

    let delete_button = document.createElement("a");
    delete_button.setAttribute("class", "back_button");
       // back_button.setAttribute("href", "./home.html")
    delete_button.innerText = ("Delete");
    simple_detail.append(delete_button);


    let edit_profile = document.createElement("div");
    edit_profile.setAttribute("class", "edit_profile");
    document.querySelector(".main").append(edit_profile);


    let heading_profile = document.createElement("div");
    heading_profile.setAttribute("class", "heading_profile");
    edit_profile.append(heading_profile);

    let heading = document.createElement("h2");
    heading.setAttribute("class", "heading");
    heading.innerText = ("Edit Profile");
    heading_profile.append(heading);



    let form_profile = document.createElement("div");
    form_profile.setAttribute("class", "form_profile");
    edit_profile.append(form_profile);


    let head = [

        {
            "label": "Name",
            "id": "fname",
            "for": "fname",
            "place_holder": "Name",
            "disable": "disable"

        },

        {
            "label": "Phone.no",
            "id": "phone",
            "for": "phone",
            "place_holder": "Phone.no"


        },


        {
            "label": "Email id",
            "id": "email",
            "for": "email",
            "place_holder": "Email id"


        },

        {
            "label": "DOB",
            "id": "dob",
            "for": "dob",
            "place_holder": "DOB"


        },

        {
            "label": "District",
            "id": "district",
            "for": "district",
            "place_holder": "District"


        },

        {
            "label": "State",
            "id": "state",
            "for": "state",
            "place_holder": "State"

        },




    ]

    for (let i = 0; i < head.length; i++) {

        let contant_profile = document.createElement("div");
        contant_profile.setAttribute("class", "form-floating mb-3");
        form_profile.append(contant_profile);

        let input_profile = document.createElement("input");
        input_profile.setAttribute("id", head[i]["id"]);
        input_profile.setAttribute("placeholder", head[i]["place_holder"]);
        input_profile.setAttribute("disable", head[i]["disable"]);


        input_profile.setAttribute("type", "text")
        input_profile.setAttribute("class", "form-control input input1");
        contant_profile.append(input_profile);

        let label_profile = document.createElement("label");
        label_profile.setAttribute("for", head[i]["for"]);
        label_profile.innerText = head[i]["label"];

        contant_profile.append(label_profile);


    }

    let click_button = document.createElement("div");
    click_button.setAttribute("class", "click_button");
    edit_profile.append(click_button);


    let back_button = document.createElement("a");
    back_button.setAttribute("class", "back_button");
    back_button.setAttribute("href", "./home.html")
    back_button.innerText = ("Back to home");
    click_button.append(back_button);
   


    let edit_button = document.createElement("a");
    edit_button.setAttribute("class", "back_button");
    edit_button.innerText = ("Edit");
    click_button.append(edit_button);





    let show = JSON.parse(localStorage.getItem('array')); 

    let account_name = localStorage.getItem("first_name");

    let email_compare = localStorage.getItem("email");


    let current_user;
    show.find(e => { // parameterized e-->show[0],[1]

        if (e["email"] === email_compare) {

            return current_user = e
            // console.log(e);

        }
    }
    )
    document.querySelectorAll("#fi_name")[0].innerText = current_user["fname"] //[0]

    
    document.getElementById("fname").value = current_user["fname"] //show[0]["fname"] //dharun
    document.getElementById("phone").value = current_user["phone"]
    document.getElementById("email").value = current_user["email"]
    document.getElementById("dob").value = current_user["dob"]
    document.getElementById("district").value = current_user["district"]
    document.getElementById("state").value = current_user["state"]

    edit_button.addEventListener("click", () => {

        for (let i = 0; i < show.length; i++) {

            if (document.getElementById("email").value == show[i]["email"]) {

                show[i].dob = document.getElementById("dob").value;
                show[i].district = document.getElementById("district").value;
                show[i].state = document.getElementById("state").value;

            }
        }

        if (document.getElementById("fname").value != "" && document.getElementById("email").value != "") {
            localStorage.setItem('array', JSON.stringify(show))
            alert("Successfully your profile updated")
        }
        else {
            alert("Your name or some fields could not be empty")
        }
    });

    console.log(document.getElementById("simple_image").getAttribute("src"), "efrdcvzx");

    delete_button.addEventListener("click", () => {

        for (let i = 0; i < show.length; i++) {
            if (document.getElementById("email").value == show[i]["email"]) {
                // confirm("comfortable with it")
                show.splice(i, 1)
                localStorage.setItem("array", JSON.stringify(show));
                window.location.href = "../index.html";
            }
        }
    })


    let input_img = document.querySelector("#simple_upload");

    let image = document.querySelector("#simple_image");


    input_img.addEventListener("change", function () {



        let change_photo = this.files[0];

        if (change_photo) {
            const reader = new FileReader();

            reader.addEventListener("load", function () {

                image.setAttribute("src", reader.result);
                let us1 = JSON.parse(localStorage.getItem("array"))

                us1.forEach(element => {
                         
                });

                us1[0]["image"] = image.getAttribute("src")
                localStorage.setItem("array", JSON.stringify(us1))
            })

            reader.readAsDataURL(change_photo);

        }

    })


    let us1 = JSON.parse(localStorage.getItem("array"))
        let new_src= us1[0]["image"] 
        image.setAttribute("src",new_src)

</script>

</html>