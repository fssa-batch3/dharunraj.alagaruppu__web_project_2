<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>History</title>
    <link rel="stylesheet" href="../assets/css/common_style.css">
    <link rel="stylesheet" href="../assets/css/history.css">
    <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous"> -->
</head>

<body>

    <header>

        <div class="title">
            <a href="./home.html">NET BLIZ</a>
        </div>

        <div class="full_link">
            <div>
                <a href="./home.html">Home</a>
            </div>


            <div>
                <a href="./fund_transfer.html">Transfer</a>
            </div>


            <div>
                <a href="./balance_enquire.html">Balance</a>
            </div>

            <div>
                <a class="current_page" href="#">History</a>
            </div>

            <div class="logout">
                <a href="../index.html">Log Out</a>
            </div>

        </div>

    </header>

    <div class="welcome">

        <div class="background">

            <div class="search">
                <img src="../assets/img/5138de707a808fdcb21f8190a417a259.png_wh860-removebg-preview.png" alt="search">
                <label for="search"></label>
                <input type="search" id="search" name="search" placeholder="History here">
            </div>

            <div class="right_filter">

                <div class="filter">

                    <div class="filter_icon">

                        <img src="../assets/img/filter_icon.png" alt="filter_icon">
                        <span>Filter</span>
                    </div>

                    <img src="../assets/img/arrow_icon.png" alt="arrow_icon">

                </div>

                <div class="select_div">

                    <select class="form-select accounts" id="from" aria-label="Example select with button addon"
                        required>

                        <option value="">Choose your Ac.No</option>




                    </select>

                    <button id="result_button">check</button>

                </div>



            </div>




        </div>

    </div>


    <main>




    </main>


    <script>


        let signup_array = JSON.parse(localStorage.getItem("array"));

        let email = localStorage.getItem("email");

        let history = JSON.parse(localStorage.getItem("history_table")) ?? [];

        let balance_enquire = JSON.parse(localStorage.getItem("bal_enquire"));

        let account_details = JSON.parse(localStorage.getItem("account_details"));

        let primary_account;

        let accounter;


        let function_account;
        let function_image;
        let type;
        let function_amount;
        let icon;
        let id;
        let function_date;
        let function_current_balance;

        // **************************************************


        let sender_value;
        let reciver_value;

        let sender_email;
        let reciver_email;

        let account_value;



        // ***********************************************

        active_user()
        function active_user() {

            for (let i = 0; i < signup_array.length; i++) {

                if (signup_array[i]["email"] == email) {

                    // console.log("jk")

                    main()

                    // console.log("jk")
                }

            }


        }


        function main() {


            for (let j = 0; j < history.length; j++) {

                sender_value = history[j]["sender_account"];
                reciver_value = history[j]["reciver_account"];

                sender_email = history[j]["sender_email"];
                reciver_email = history[j]["reciver_email"];

                // console.log("jk")

                // account_search()

                account_search(sender_value, reciver_value, sender_email, reciver_email, j)

            }

        }


        function account_search(sender_value, reciver_value, sender_email, reciver_email, j) {


            for (let k = 0; k < account_details.length; k++) {

                account_value = account_details[k]["account"];

                if (sender_value == account_value && sender_email == email) {

                    // function_account = history[j]["reciver_name"];

                    // function_image = "../assets/img/hdfc_icon.png"
                    // type = history[j]["sender_type"]
                    // function_amount = history[j].send_amount
                    // icon = "../assets/img/minus_icon.png"
                    // id = "minus";
                    // function_date = history[j]["date"]
                    // function_current_balance = history[j]["sender_balance"];



                    function_account = history[j]["reciver_name"];

                    function_image = "../assets/img/hdfc_icon.png"
                    type = history[j]["sender_type"]
                    function_amount = history[j].send_amount
                    icon = "../assets/img/minus_icon.png"
                    id = "minus";
                    function_date = history[j]["date"]
                    function_current_balance = history[j]["sender_balance"];


                    create_div(function_account, function_image, type, function_amount, icon, id, function_date, function_current_balance)

                }

                else if (reciver_value == account_value && reciver_email == email) {

                    function_account = history[j]["sender_name"];
                    function_image = "../assets/img/hdfc_icon.png"
                    type = history[j]["reciver_type"]
                    function_amount = history[j].send_amount
                    icon = "../assets/img/plus_icon.png";
                    id = "plus";
                    function_date = history[j]["date"]
                    function_current_balance = history[j]["reciver_balance"];



                    create_div(function_account, function_image, type, function_amount, icon, id, function_date, function_current_balance)
                }

            }
        }




        function create_div(function_account, function_image, type, function_amount, icon, id, function_date, function_current_balance) {

            let main_div = document.querySelector("main")


            let new_container = document.createElement("div");
            new_container.setAttribute("class", "history");
            document.querySelector("main").append(new_container);


            let send = document.createElement("div");
            send.setAttribute("class", "send_data");
            new_container.append(send);

            let type_fund = document.createElement("div");
            type_fund.setAttribute("class", "type_fund");
            send.append(type_fund);

            let image = document.createElement("img");
            image.setAttribute("id", "bank_icon")
            image.setAttribute("src", function_image);
            image.setAttribute("alt", "bank_icon");
            type_fund.append(image);

            let transfer_type = document.createElement("div");
            transfer_type.setAttribute("class", "transfer_type");
            type_fund.append(transfer_type);

            let increase = document.createElement("h2");
            increase.setAttribute("class", "increase");
            increase.setAttribute("id", "increase");
            increase.innerText = type;
            transfer_type.append(increase);

            let reciver_name = document.createElement("p");
            reciver_name.setAttribute("class", "reciver_name");
            reciver_name.innerText = function_account;
            transfer_type.append(reciver_name);


            let amount = document.createElement("div");
            amount.setAttribute("class", "amount");
            send.append(amount);

            let minus = document.createElement("h4");
            minus.setAttribute("class", "minus");
            minus.setAttribute("id", id);
            minus.innerText = "₹" + "" + function_amount;
            amount.append(minus);

            let type_model = document.createElement("img");
            type_model.setAttribute("src", icon);
            type_model.setAttribute("alt", "bank_icon");
            amount.append(type_model);


            let balance_data = document.createElement("div");
            balance_data.setAttribute("class", "balance_data");
            new_container.append(balance_data)

            let date = document.createElement("h3");
            date.setAttribute("class", "date");
            date.setAttribute("id", "date");
            date.innerHTML = function_date;
            balance_data.append(date);

            let balance_span = document.createElement("span");
            balance_span.setAttribute("class", "balance_span");
            balance_span.innerText = "Balance :";
            balance_data.append(balance_span);

            let balance = document.createElement("h3");
            balance.setAttribute("class", "balance_span");
            balance.innerText = "₹" + " " + function_current_balance;
            balance_span.append(balance);

        }



        let search = document.querySelector("#search");

        let histroy = document.querySelectorAll(".history");


        search.addEventListener("keyup", (key) => {

            let values = key.target.value.toLowerCase();


            for (let i = 0; i < histroy.length; i++) {

                let fund_type = histroy[i].querySelector(".increase").innerHTML.toLowerCase();

                if ((fund_type.includes(values))) {

                    histroy[i].style.display = "block";

                }

                else {

                    histroy[i].style.display = "none";
                }
            }

        });

        option()
        function option() {

            let current_ac = document.getElementById("from")

            for (let array = 0; array < signup_array.length; array++) {

                for (let ac = 0; ac < account_details.length; ac++) {

                    if (signup_array[array]["email"] == email && signup_array[array]["email"] == account_details[ac]["email_compare"]) {

                        let account_match = account_details[ac]["account"];

                        let option = document.createElement("option");
                        option.setAttribute("value", account_match);
                        option.innerHTML = (account_match);
                        current_ac.append(option);

                    }

                }
            }
        }


        let selcet_account

        let filter_div = document.querySelector(".filter");

        filter_div.addEventListener("click", () => {

            let filter = document.querySelector(".filter");

            document.querySelector(".filter").style.display = "none";

            document.querySelector(".select_div").style.display = "block";

        });

        let result_button = document.querySelector("button");
        let select_value;

        result_button.addEventListener("click", () => {

            selcet_account = document.getElementById("from").value

            if (selcet_account != "") {

                select_value = selcet_account;
                console.log(select_value);

            }

            else {

                alert("click dropdown account number");
            }

        })



    </script>

</body>

</html>