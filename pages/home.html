<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/gh/LieutenantPeacock/SmoothScroll@1.2.0/src/smoothscroll.min.js"
        integrity="sha384-UdJHYJK9eDBy7vML0TvJGlCpvrJhCuOPGTc7tHbA+jHEgCgjWpPbmMvmd/2bzdXU"
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="../assets/css/home.css">
    <link rel="stylesheet" href="../assets/css/common_style.css">
</head>

<body>

    <header>
        <div class="title">
            <a href="./home.html">NET BLIZ</a>
        </div>

        <div class="full_link">
            <div>
                <a class="current_page" href="#">Home</a>
            </div>


            <div>
                <a href="./fund_transfer.html">Transfer</a>
            </div>


            <div>
                <a href="./balance_enquire.html">Balance</a>
            </div>

            <div>
                <a href="./history.html">History</a>
            </div>

            <div>
                <a href="./pic_chart.html">Chart</a>
            </div>

            <div class="logout">
                <a href="../index.html">Log Out</a>
            </div>
        </div>


    </header>

    <main>

        <div class="welcome">

            <div class="welcome_sms">
                <span>Welcome</span>
                <span id="fname"></span>
            </div>

            <div class="search">
                <img src="../assets/img/5138de707a808fdcb21f8190a417a259.png_wh860-removebg-preview.png" alt="search">
                <label for="search"></label>
                <input type="search" id="search" name="search" placeholder="Search here">

            </div>

            <a href="../pages/account_detail.html">
                <div class="profile">
                    <img src="../assets/img/icons8-user-100.png" alt="account">
                    <div class="detail">
                        <span id="fname"></span>
                        <span>customer</span>
                    </div>

                </div>
            </a>

        </div>

        <!-- link bank account 1st container ** -->

        <div class="back_link">

            <img src="../assets/img/202101-Talent-Trends-2_xxpjxy.gif" alt="intro">
            <div class="link_bank">

                <h2>Link a bank account</h2>
                <p>You'll need to link and confirm to our bank account before you can receive Payment with Banking.
                    We'll automatically withdraw the funds in your NET BLIZ account to the bank account </p>

                <form>
                    <label for="account"> Account number </label>
                    <input class="form-control" type="text" id="account" name="account" required pattern="[0-9]{16,17}"
                        title="Remember !! Your bank account number should be 16 numbers">

                    <label for="ifsc"> IFSC code </label>
                    <input class="form-control" type="text" id="ifsc" name="ifsc" required pattern="[0-9A-Za-z]{5,15}"
                        title="Are you sure !! minium Your ifsc number should be 12 numbers">

                    <label for="phone">Phone number</label>
                    <input class="form-control" type="tel" id="phone" name="phone" required pattern="[0-9]{12}"
                        title="Country code ( 91 )+ Your correct phone number ">

                    <h6>Choose minium balance</h6>
                    <div class="input-group mb-3 drop_down">

                        <select class="form-select" id="inputGroupSelect03"
                            aria-label="Example select with button addon" required>

                            <option value="">please select correctly amount *</option>
                            <option value="500">₹ 500-/</option>
                            <option value="1000">₹ 1,000-/</option>
                            <option value="2500">₹ 2,500-/</option>
                            <option value="5000">₹ 5,000-/</option>
                            <option value="10000">₹ 10,000-/</option>
                            <option value="25000">₹ 25,000-/</option>



                        </select>
                    </div>

                    <h5>Account name</h5>

                    <input type="radio" name="detail" id="personal" required> <label for="personal">Savings
                        Account</label> <br>
                    <input type="radio" name="detail" id="business"> <label for="business">Current Account </label> <br>
                    <!-- <input type="radio" name="detail" id="savings"> <label for="savings">Savings Account</label> <br> -->

                    <p>Remember to double-check your account number . Banks may not flag errors until you transfer funds
                    </p>

                    <button class="btn btn-primary">Link Your Bank</button>

                </form>
            </div>

        </div>

        <div class="bank_account remove_hide" id="bank_account">

            <!-- <div class="bank">
                <img src="../assets/img/account.png" alt="account">

                <div>
                    <label for="account_give">Account Number </label>
                    <input class="form-control" type="text" id="account_give" name="account_give" required>
                </div>


                <div>
                    <label for="ifsc_give">IFSC Code</label> <br>
                    <input class="form-control" type="text" id="ifsc_give" name="ifsc_give" required>
                </div>

                <div>
                    <label for="phone_give">Phone no</label> <br>
                    <input class="form-control" type="number" id="phone_give" name="phone_give" required>
                </div>

                <div>
                    <label for="pincode_give">Pincode</label> <br>
                    <input class="form-control" type="text" id="pincode_give" name="pincode_give" required>
                </div>

            </div> -->

        </div>

    </main>

    <footer>

        <div class="back_foot">

            <h3>@ 2023 NET BLIZ</h3>


            <div class="icon_social">

                <a href="https://www.linkedin.com/"> <img src="../assets/img/icons8-linkedin-100 (1).png"
                        alt="linked in"></a>
                <a href="https://www.facebook.com/"><img src="../assets/img/icons8-facebook-100.png" alt="facebook"></a>
                <a href="https://www.instagram.com/"><img src="../assets/img/icons8-google-100-removebg-preview.png" alt="google"></a>
                <a href="https://twitter.com/"> <img src="../assets/img/icons8-twitter-100.png" alt="teitter"></a>

            </div>

        </div>


    </footer>

    <script>

        let show = JSON.parse(localStorage.getItem('array'));

        let account_detail = JSON.parse(localStorage.getItem("account_details")) ?? [];

        let balance_enquire = JSON.parse(localStorage.getItem("bal_enquire")) ?? [];

        let email_compare = localStorage.getItem("email");

        let accounter_name;

        let btn_submit = document.querySelector("form");

        btn_submit.addEventListener("submit", (e) => {
            e.preventDefault()
            link_bank();
        });


        show.forEach(element => { //[{0},{1},......]

            if (element["email"] === email_compare) { //e=arr[0]

                document.querySelectorAll("#fname")[0].innerText = element["fname"] + ","//[0,1]
                document.querySelectorAll("#fname")[1].innerText = element["fname"]

                accounter_name = element["fname"];

                localStorage.setItem("array", JSON.stringify(show));
            }
        })


        let account;
        let ifsc;
        let phone;
        let minium;
        let balance;
        let personal;
        let business;
        let account_type;


        let branch;
        let bank_name;

        let account_store;
        let table_obj;

        function link_bank() {

            account = document.getElementById("account").value.trim();
            ifsc = document.getElementById("ifsc").value.trim();
            phone = document.getElementById("phone").value.trim();
            minium = document.getElementById("inputGroupSelect03").value.trim()
            email_compare = localStorage.getItem("email");
            balance = Math.floor(Math.random() * 10000);
            personal = document.getElementById("personal");
            business = document.getElementById("business");
            account_type;

            if (personal.checked) {
                account_type = "Savings Account"

            }
            else if (business.checked) {
                account_type = "Current Account"
            }

            let succuess;

            show.find(element => {

                if (element["email"] === email_compare) {

                    if (element["phone"] == phone) {

                        succuess = 1;
                    }
                }

            });

            if (succuess == 1) {

                api();
            }
            else {

                alert("Mobile number is not match with your regsistered data")
            }

        }
        function api() {

            fetch(`https://api.sandbox.co.in/bank/${ifsc}`)

                .then((results) => {

                    return results.json();

                })

                .then((data) => {

                    if (data["BRANCH"] == undefined && data["BANK"] == undefined) {

                        alert("Enter the correct IFSC code or recheck ")

                    }
                    else {
                        console.log(data)
                        branch = data["BRANCH"]
                        bank_name = data["BANK"]
                        add_local();

                    }

                });

        }


        function add_local() {

            account_store = {
                "account": account,
                "ifsc": ifsc,
                "phone": phone,
                "email_compare": email_compare,
                "balance": balance,
                "ac_type": account_type,
                "branch": branch,
                "accounter_name": accounter_name,
                "bank_name": bank_name,

            }

            table_obj = {
                "ac_no": account,
                "ac_type": account_type,
                "ac_balance": balance,
                "email_compare": email_compare,
                "accounter_name": accounter_name,
                "minium": minium,
                "ac_ifsc": ifsc,

            }

            let res;

            for (let i = 0; i < account_detail.length; i++) {

                if (account_detail[i]["account"] === account) {
                    res = 1;
                    break;
                }
            }

            if (res == 1) {
                alert(" This account number is already exited")
            }

            else {

                account_detail.push(account_store);

                balance_enquire.push(table_obj);

                localStorage.setItem("account_details", JSON.stringify(account_detail));

                localStorage.setItem("bal_enquire", JSON.stringify(balance_enquire));

                open_primary()

                alert("Thanks for add account");

                smoothScroll({ yPos: 'end', duration: 1000 });

                location.reload();

            }

        }


        // In this function is used to when user is link new bank account that account number is set the primary account


        function open_primary() {

            for (let op = 0; op < show.length; op++) {

                if (show[op]["email"] == email_compare) {

                    let start = show[op]["primary"];

                    start = "";

                    show[op]["primary"] = account;

                    localStorage.setItem("array", JSON.stringify(show));

                    open_average()
                }

            }

        }

        function open_average() {

            console.log("trew")

            for (let j = 0; j < balance_enquire.length; j++) {

                console.log(Number(account))

                if ((balance_enquire[j]["ac_no"]) == Number(account)) {

                    console.log(account);

                    balance = balance_enquire[j]["ac_balance"];

                    let month = balance_enquire[j]["monthly_balance"] ?? [];

                    let rotine = {

                        "day_balance": balance,
                    }

                    month.push(rotine);

                    balance_enquire[j]["monthly_balance"] = month

                    localStorage.setItem("bal_enquire", JSON.stringify(balance_enquire));

                    let average_value = 0;

                    for (let r = 0; r < balance_enquire[j]["monthly_balance"].length; r++) {

                        console.log(average_value)

                        average_value += balance_enquire[j]["monthly_balance"][r]["day_balance"]

                        console.log(average_value)

                    }

                    let average_balance;

                    average_balance = (average_value / balance_enquire[j]["monthly_balance"].length).toFixed(2);

                    balance_enquire[j]["average_value"] = average_balance

                }

            }

            localStorage.setItem("bal_enquire", JSON.stringify(balance_enquire));


        }

        // function average() {

        //     for (let h = 0; h < balance_enquire.length; h++) {

        //         let average_value = 0;

        //         if (balance_enquire[h]["monthly_balance"]) {

        //             for (let r = 0; r < balance_enquire[h]["monthly_balance"].length; r++) {

        //                 average_value += balance_enquire[h]["monthly_balance"][r]["day_balance"]
        //             }

        //             let average_balance;

        //             average_balance = (average_value / balance_enquire[h]["monthly_balance"].length).toFixed(2);

        //             balance_enquire[h]["average_value"] = average_balance
        //         }


        //     }

        //     localStorage.setItem("bal_enquire", JSON.stringify(balance_enquire));

        // }

        let k = 0;

        let selectvalue;

        account_detail.forEach(e => {

            if (e["email_compare"] == email_compare) {

                document.getElementById("bank_account").style.display = "flex";

                let bank_div = document.querySelector("#bank_account");

                let bank = document.createElement("div");
                bank.setAttribute("class", "bank");
                bank_div.append(bank);

                let image = document.createElement("img");
                image.setAttribute("src", "../assets/img/account.png")
                image.setAttribute("alt", "hello");
                image.setAttribute("class", "bank_detail_image");
                bank.append(image);


                let data = [

                    {
                        "label": "Account no",
                        "for": "account_give",


                        "type": "text",
                        "id": "account_give",
                        "class": "account_give form-control input_size",
                        "name": "account_give",
                        "place_holder": "Account no",
                        "disable": "disable",

                    },

                    {
                        "label": "IFSC Code",
                        "for": "ifsc_give",

                        "type": "text",
                        "id": "ifsc_give",
                        "class": "ifsc_give form-control input_size",
                        "name": "ifsc_give",
                        "place_holder": "IFSC Code",
                        "disable": "disable",

                    },

                    {
                        "label": "Branch Name",
                        "for": "branch",

                        "type": "text",
                        "id": "branch",
                        "class": "branch form-control input_size",
                        "name": "branch",
                        "place_holder": "Branch Name",
                        "disable": "disable"

                    },

                ]



                for (let i = 0; i < data.length; i++) {

                    let contant = document.createElement("div");
                    contant.setAttribute("class", "form-floating mb-3");
                    bank.append(contant);

                    let input = document.createElement("input");
                    input.setAttribute("type", data[i]["type"]);
                    input.setAttribute("id", data[i]["id"]);
                    input.setAttribute("class", data[i]["class"]);
                    input.setAttribute("name", data[i]["name"]);
                    input.setAttribute("placeholder", data[i]["place_holder"]);
                    input.setAttribute("disable", data[i]["disable"]);
                    contant.append(input);


                    let label = document.createElement("label");
                    label.innerText = data[i]["label"];
                    label.setAttribute("for", data[i]["for"]);
                    contant.append(label);

                }

                let set_primary = document.createElement("div");
                set_primary.setAttribute("class", "set_primary")
                bank.append(set_primary);


                let primary = document.createElement("input");
                primary.setAttribute("type", "radio");
                primary.setAttribute("id", e.account);
                primary.setAttribute("class", "input-radio");
                primary.setAttribute("value", e.account);
                primary.setAttribute("name", "primary");
                set_primary.append(primary);

                let primary_label = document.createElement("label");
                primary_label.setAttribute("for", e.account);
                primary_label.innerHTML = ("Set primary account");
                set_primary.append(primary_label);

                let btn = document.createElement("button");
                btn.setAttribute("id", "remove_bk");
                btn.setAttribute("class", "btn btn-primary remove_bk");
                btn.innerText = "Remove bank account !!"
                bank.append(btn);


                let symbal = document.createElement("div");
                symbal.setAttribute("class", "tick_append");
                bank.append(symbal);


                document.getElementsByClassName("account_give")[k].value = e["account"];
                document.getElementsByClassName("ifsc_give")[k].value = e["ifsc"];
                document.getElementsByClassName("branch")[k].value = e["branch"];

                k++

                primary.addEventListener('click', function () {

                    selectvalue = primary.value;

                    console.log(selectvalue)

                    for (let ko = 0; ko < show.length; ko++) {

                        if (show[ko]["email"] == email_compare) {

                            show[ko]["primary"] = selectvalue;

                            localStorage.setItem("array", JSON.stringify(show));

                            window.location.href = "./balance_enquire.html"
                        }

                    }

                });

            }

        });


        // Bank account detail div append the tick symbal and the information message function   ****

        let account_numbers = document.querySelectorAll(".account_give")

        show.forEach(e => {

            account_numbers.forEach((el, ind) => {

                if (el.value == e["primary"] && e["email"] == email_compare) {

                    let primary = document.querySelectorAll(".tick_append");

                    let unique_div = document.createElement("div");
                    unique_div.setAttribute("class", "unique_div")

                    let primary_tick_image = document.createElement("img");
                    primary_tick_image.setAttribute("src", "../assets/img/tick_balance.png")
                    primary_tick_image.setAttribute("alt", "tick");
                    primary_tick_image.setAttribute("id", "primary_tick")
                    unique_div.append(primary_tick_image);

                    let news = document.createElement("span");
                    news.setAttribute("id", "default");
                    news.innerText = "Default bank account";
                    unique_div.append(news);

                    primary[ind].append(unique_div);

                }
            })

        });

        // In this function used to remove bank account what account is linked in my website ( remove button )

        const btn1 = document.querySelectorAll(".remove_bk");

        let account_num;

        for (let ic = 0; ic < btn1.length; ic++) {
            btn1[ic].addEventListener("click", (account, balance) => {

                account_num = document.getElementsByClassName("account_give")[ic].value;

                for (let a = 0; a < account_detail.length; a++) {

                    if (account_detail[a]["account"] == account_num && email_compare == account_detail[a]["email_compare"]) {

                        account_detail.splice(a, 1);

                        localStorage.setItem("account_details", JSON.stringify(account_detail));

                        primary_check();
                        clear_balance();

                        location.reload();
                    }
                }

            })
        }

        function primary_check() {

            console.log(account_num);

            for (let kd = 0; kd < show.length; kd++) {

                if (show[kd]["primary"] == account_num) {

                    show[kd]["primary"] = "";

                    localStorage.setItem("array", JSON.stringify(show));

                    location.reload();

                }

            }
        }

        function clear_balance() {

            for (let b = 0; b < balance_enquire.length; b++) {

                if (balance_enquire[b]["ac_no"] == account_num && email_compare == balance_enquire[b]["email_compare"]) {

                    balance_enquire.splice(b, 1);

                    localStorage.setItem("bal_enquire", JSON.stringify(balance_enquire));

                }

            }

        }

        // bank_img()

        function bank_img(bank_name) {

            // let bank_img = document.querySelector(".bank_detail_image");
            // console.log(bank_img)

            if (bank_name == "Canara Bank") {

                document.getElementsByClassName("bank_detail_image").src = "../assets/img/canara.png"
            }

        }

    </script>

    <script type="text/javascript" src="../assets/js/common_function.js"></script>
    <!-- <script src="../assets/js/admin.js"></script> -->
























    <!-- <script type="text/javascript" src="../assets/js/home.js"></script> -->

    <!-- <script type="module" src="../assets/js/home.js"> </script> -->

    <!-- <img src="../assets/img/tick_balance.png" alt="tick"> -->



    <!-- function random() {
    alpha = ["A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "K", "L", "M", "N", "O", "P", "Q", "R", "S", "T", "U",
    "V", "W", "X", "Y", "Z"]
    let random = Number(Math.floor(Math.random() * 26))
    alpha_random = alpha[random]
    console.log(random);
    alpha.splice(random, 1)
    } -->

    <!-- // let alpha
    // let alpha_random
    // random()


    // console.log(alpha_random); -->

</body>

<!-- <img src="../assets/img/canara.png" alt=""> -->

</html>